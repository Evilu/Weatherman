FROM postgres:16.1

# Create directory for init scripts
RUN mkdir -p /docker-entrypoint-initdb.d

# Copy initialization SQL scripts generated by Prisma into docker-entrypoint-initdb.d
# Expect these files to exist in the repo at ./databases/deployments/weatherman/pgdata/
COPY ./databases/deployments/weatherman/pgdata/01_init.sql /docker-entrypoint-initdb.d/
COPY ./databases/deployments/weatherman/pgdata/02_functions.sql /docker-entrypoint-initdb.d/

# Ensure scripts are executable
RUN chmod -R 755 /docker-entrypoint-initdb.d

# Expose Postgres port
EXPOSE 5432

# Default command (can be overridden by compose)
CMD ["postgres", "-c", "log_statement=all"]

